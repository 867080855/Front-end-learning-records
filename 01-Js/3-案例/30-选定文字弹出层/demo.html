<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>弹出层</title>
    <style>
        #con,#uncon{
            text-indent: 2em;
            width: 400px;
            margin:100px;
            float: left;
            position: relative;
        }
        #con span,#uncon span{
            margin:0;
            padding:0;
            font-size: 40px;
        }
        i{
            width: 93px;
            height: 93px;
            background: #008aff;
            position: absolute;
            top:0;
            left:0;
            display: none;
            overflow: hidden;
        }
    </style>
</head>
<body>
    <div id="con">
        <span>有弹出层：</span>
        <i id="layer"></i>
        <div>
            每个人都有属于自己的一片森林,迷失的人迷失了,相逢的人会再相逢。
            鱼说：“你看不见我眼中的泪，因为我在水中。” 水说：“我能感觉到你的泪，因为你在我心中。”
            我渐渐能意会到，深刻并不等于接近事实。——《挪威的森林》
            但我那时还不懂，不懂自己可能迟早要伤害一个人，给她以无法愈合的重创。在某种情况下，一个人的存在本身就要伤害另一个人。——《国境以南太阳以西》
            山川寂寥，街市井然，居民相安无事。可惜人无身影，无记忆，无心。男女可以相亲却不能相爱。爱须有心，而心已被嵌入无数的独角兽头盖骨化为“古老的梦”——《世界尽头与冷酷仙境》
            死已不再是生的对立。死早已存在于我的体内，任你一再努力，你还是无法忘掉的。——《挪威的森林》
            他想把胸中的感念告诉对方：我们的心不是石头。石头也迟早会粉身碎骨，面目全非。但心不会崩毁。对于那种无形的东西——无论善还是恶——我们完全可以互相传达。——《神的孩子全跳舞》
            不存在十全十美的文章，如同不存在彻头彻尾的绝望。——《且听风吟》
            两人记忆的烛光委实过于微弱，两人的话语也不似十四年前那般清晰。结果连句话也没说便擦身而过，径直消失在人群中，永远永远。——《四月一个晴朗的早晨，遇见一个百分之百的女孩》
            我一直以为人是慢慢变老的，其实不是，人是一瞬间变老的。——《舞！舞！舞！》
            至于我是何以抛弃原来世界而不得不来到这世界尽头的，我却无论如何也无从记起，记不起其过程、意义和目的。是某种东西、某种力量——是某种岂有此理的强大力量将我送到这里来的！因而我才失去身影和记忆，并正将失去心。——《世界尽头与冷酷仙境》
            人，人生，在本质上是孤独的，无奈的。所以需要与人交往，以求相互理解。然而相互理解果真可能吗？不，不可能，宿命式的不可能，寻求理解的努力是徒劳的。那么，何苦非努力不可呢？为什么就不能转变一下态度呢——既然怎么努力争取理解都枉费心机，那么不再努力就是，这样也可以活得蛮好嘛！换言之，与其勉强通过交往来消灭孤独，化解无奈，莫如退回来把玩孤独，把玩无奈！
        </div>
    </div>
    <div id="uncon">
        <span>无弹出层:</span><br/>
        <div>
            每一次，当他伤害我时，我会用过去那些美好的回忆来原谅他，然而，再美好的回忆也有用完的一天，到了最后只剩下回忆的残骸，一切都变成了折磨，也许我的确是从来不认识他。
            如果我捉不住他，留不住他，我会让他飞。因为他有自己的翅膀，有选择属于自己的天空的权利。
            希望你下辈子不要改名，这样我会好点找你一点。有时失去不是忧伤，而是一种美丽。
            当我们学会用积极的心态去对待“放弃”时，我们将拥有“成长”这笔巨大的财富。
            对相爱的人来说，对方的心才是最好的房子。
            追求得到之日即其终止之时，寻觅的过程亦即失去的过程。—《国境以南 太阳以西》
            网无所不在，网外有网，无处可去。若扔石块，免不了转弯落回自家头上……时代如流沙，一般流动不止，我们所站立的位置又不是我们站立的位置——《舞舞 舞》
            世上有可以挽回的和不可挽回的事，而时间经过就是一种不可挽回的事。——《国境以南太阳以西》
            不要同情自己，同情自己是卑劣懦夫干的勾当。 ——《挪威的森林》
            死并非生的对立面，而作为生的一部分永存。 ——《挪威的森林》
            人死总是有其相应的缘由的。看上去单纯而并不单纯。根是一样的。即使露在地面上的部分只是一点点，但用手一拉就会连接出来很多。人的意识这种东西是在黑暗深处扎根生长的。盘根错节，纵横交织……无法解析的部分过于繁多。真正原因只有本人才明白，甚至本人都懵懵懂懂。——《舞！舞！舞！》
            那时我懂了，我们尽管是再合适不过的旅伴，但归根结蒂仍不过是描绘各自轨迹的两个孤独的金属块儿。远看如流星一般美丽，而实际上我们不外乎是被幽禁在里面的、哪里也去不了的囚徒。当两颗卫星的轨道偶尔交叉时，我们便这样相会了。也可能两颗心相碰，但不过一瞬之间。下一瞬间就重新陷入绝对的孤独中。总有一天会化为灰烬。—— 《斯普特尼克恋人》
        </div>
    </div>
    <script>
        //待解决的问题1：
            //如果选中的文字超过了layer的高度会在外显示
            //可以采用overflow:hidden；
            //有没有别的方法？
        //待解决的问题2：
            //如果翻页会导致clientX失效。
            //可以采用pageX
            //ie不兼容，有没有别的办法？
        //事件操作只写函数，具体的东西应该写出去。
        function $id(id){return document.getElementById(id);}
        var con = $id("con");
        var layer = $id("layer");
        con.onmouseup = function (event) {
            var event = event || window.event;
            var x = event.clientX - con.offsetTop;
            var y = event.clientY - con.offsetLeft;
            //console.log(x+"   "+y);
            var txt = "";
            if(window.getSelection){
                txt = window.getSelection().toString();  //转换为字符串
            }else{
                txt = document.selection.createRange().text;     //转换为字符串
            }
            //所有的字符串都为真，空为假，
                //所有的数字都为真，零为假
            if(txt){
                popLayer(x,y,txt);
                //不能在这个地方写定时器，因为出现了括号，相当于直接被调用了。
                //应该在函数定义的地方写。
                    //setTimeout(popLayer(x,y,txt),3000);
            }
        };
        document.onmousedown = function (event) {
            var event = event || window.event;
            var tarId = event.target? event.target.id :event.srcElement.id;
            if(tarId != "layer"){
                layer.style.display = "";
            }
        };
        function popLayer(x,y,txt){
            setTimeout(function () {
                layer.style.display = "block";
                layer.style.left = x + "px";
                layer.style.top = y + "px";

                layer.innerHTML = txt;
                //layer.style.innerHTML = "done";----错误的。不需要假style
            },500)
        }
    </script>
</body>
</html>